<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Link Shortener & File Sharing</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="./webinterface/create.js"></script>
</head>
<style>
  .container {
  min-height: 200px;
  height: auto;
  width: 100%;
  border-radius: 12px;
  border: 2px dashed #374151;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  padding: 24px 20px;
  gap: 12px;
  background: #1f2937;
  transition: all 0.2s ease;
}

.container.drag-over {
  background: #2d1b3d;
  border-color: #fc03cf;
}

.header {
  flex: 0 0 auto;
  width: 100%;
  border: 2px dashed #374151;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  padding: 20px;
  background: #111827;
  transition: all 0.2s ease;
}

.header svg {
  height: 56px;
  color: #6b7280;
}

.header p {
  text-align: center;
  color: #9ca3af;
  font-weight: 500;
  margin-top: 8px;
  font-size: 13px;
}

.footer {
  background: #111827;
  width: 100%;
  min-height: 44px;
  padding: 10px 14px;
  border-radius: 8px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: space-between;
  color: #e5e7eb;
  border: 1px solid #374151;
  transition: all 0.2s ease;
}

.footer:hover {
  background: #1f2937;
  border-color: #fc03cf;
}

.footer svg {
  height: 18px;
  width: 18px;
  fill: #fc03cf;
  background: rgba(252, 3, 207, 0.1);
  border-radius: 6px;
  padding: 5px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.footer p {
  flex: 1;
  text-align: center;
  font-weight: 500;
  font-size: 13px;
}

#file {
  display: none;
}

.format-menu {
  border: 1px solid #374151;
  border-radius: 8px;
  background: #1f2937;
  max-height: 300px;
  overflow-y: auto;
  position: absolute;
  width: 100%;
  bottom: 100%;
  top: auto;
  left: 0;
  z-index: 1000;
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
}

.format-selector {
  position: relative;
  width: 100%;
}

.format-category {
  border-bottom: 1px solid #374151;
}

.format-category:last-child {
  border-bottom: none;
}

.category-header {
  padding: 12px 16px;
  background: #111827;
  font-weight: 600;
  color: #e5e7eb;
  font-size: 13px;
}

.format-options {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
  gap: 6px;
  padding: 12px;
}

.format-option {
  padding: 8px 12px;
  text-align: center;
  border: 1px solid #374151;
  border-radius: 6px;
  cursor: pointer;
  background: #111827;
  transition: all 0.2s;
  font-size: 12px;
  font-weight: 500;
  color: #e5e7eb;
}

.format-option:hover {
  background: #1f2937;
  border-color: #fc03cf;
}

.format-option.selected {
  background: #fc03cf;
  color: white;
  border-color: #fc03cf;
}

.hidden {
  display: none !important;
}

.container .footer {
  margin-top: auto;
}

.format-display {
  padding: 12px 16px;
  border: 1px solid #374151;
  border-radius: 8px;
  background: #111827;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  color: #e5e7eb;
  transition: all 0.2s ease;
}

.format-display:hover {
  border-color: #fc03cf;
}

.format-arrow {
  transition: transform 0.2s;
  color: #9ca3af;
}

.format-arrow.open {
  transform: rotate(180deg);
}

.popup-content {
    transform: scale(0.8);
    opacity: 0;
    transition: transform 0.25s cubic-bezier(.4,2,.6,1), opacity 0.25s;
  }
  .popup.show .popup-content {
    transform: scale(1);
    opacity: 1;
  }

.file-item {
  display: block;
}

.fileLi {
  padding: 10px 12px;
  border-radius: 8px;
  transition: all 0.2s ease;
  color: #e5e7eb;
  font-size: 13px;
  font-weight: 500;
  border: 1px solid transparent;
  display: flex;
  align-items: center;
  gap: 8px;
  background: #111827;
}
.fileLi:hover {
  background: #374151;
  color: #fc03cf;
  cursor: pointer;
  border-color: #4b5563;
}
.fileLi a {
  color: inherit;
  text-decoration: none;
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.custom-scrollbar {
  scrollbar-width: thin;
  scrollbar-color: #4b5563 #1f2937;
}
.custom-scrollbar::-webkit-scrollbar {
  width: 8px;
  background: #1f2937;
  border-radius: 8px;
}
.custom-scrollbar::-webkit-scrollbar-thumb {
  background: #4b5563;
  border-radius: 8px;
  border: 2px solid #1f2937;
}

.expiresIn {
  font-size: 12px;
  color: #9ca3af;
  font-weight: 400;
}

#permanentUpload:checked,
#convertPermanent:checked {
  background-color: #fc03cf;
  border-color: #fc03cf;
}

/* Resizable Sidebar Styles */
.files-sidebar {
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  background: #1f2937;
  border-right: 2px solid #374151;
  z-index: 40;
  display: flex;
  flex-direction: column;
  transition: transform 0.3s ease;
}

.sidebar-resizer {
  position: absolute;
  right: 0;
  top: 0;
  width: 4px;
  height: 100%;
  cursor: ew-resize;
  background: transparent;
  transition: background 0.2s;
}

.sidebar-resizer:hover,
.sidebar-resizer.resizing {
  background: #fc03cf;
}

.sidebar-header {
  padding: 1.5rem 1rem;
  border-bottom: 1px solid #374151;
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-shrink: 0;
}

.sidebar-content {
  flex: 1;
  overflow-y: auto;
  padding: 1rem;
}

.sidebar-toggle-mobile {
  display: none;
}

/* Mobile Styles */
@media (max-width: 1024px) {
  .files-sidebar {
    transform: translateX(-100%);
    width: 280px !important;
  }
  
  .files-sidebar.open {
    transform: translateX(0);
  }
  
  .sidebar-resizer {
    display: none;
  }
  
  .sidebar-toggle-mobile {
    display: block;
    position: fixed;
    top: 1.5rem;
    left: 1.5rem;
    z-index: 50;
    background: #1f2937;
    border: 1px solid #374151;
    padding: 0.75rem;
    border-radius: 0.5rem;
    cursor: pointer;
    transition: all 0.2s;
  }
  
  .sidebar-toggle-mobile:hover {
    background: #374151;
  }
  
  .sidebar-toggle-mobile.sidebar-open {
    left: 300px;
  }
}

@media (max-width: 640px) {
  .container {
    min-height: 200px;
    padding: 24px 16px;
    gap: 12px;
  }
  .header svg { height: 56px; }
}

/* Skeleton Loader Styles */
.skeleton {
  background: linear-gradient(90deg, #1f2937 25%, #374151 50%, #1f2937 75%);
  background-size: 200% 100%;
  animation: skeleton-loading 1.5s ease-in-out infinite;
  border-radius: 4px;
}

@keyframes skeleton-loading {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

.skeleton-text {
  height: 14px;
  margin-bottom: 8px;
}

.skeleton-title {
  height: 24px;
  margin-bottom: 12px;
}

.skeleton-box {
  height: 200px;
  width: 100%;
}

.element-loader {
  position: absolute;
  inset: 0;
  background: #1f2937;
  z-index: 10;
  display: flex;
  flex-direction: column;
  padding: 1.5rem;
  border-radius: 0.5rem;
}

.fade-out-loader {
  animation: fadeOut 0.3s ease forwards;
}

@keyframes fadeOut {
  to {
    opacity: 0;
    visibility: hidden;
  }
}
</style>
<body class="min-h-screen bg-gray-900 text-white overflow-x-hidden">
  <!-- Mobile Sidebar Toggle -->
  <button id="sidebarToggleMobile" class="sidebar-toggle-mobile" aria-label="Toggle sidebar">
    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <path d="M3 12h18M3 6h18M3 18h18" stroke-linecap="round"/>
    </svg>
  </button>

  <!-- Resizable Files Sidebar -->
  <aside id="filesSidebar" class="files-sidebar" style="width: 250px;">
    <div class="sidebar-resizer" id="sidebarResizer"></div>
    
    <div class="sidebar-header">
      <h2 class="text-lg font-bold text-white flex items-center gap-2">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M2 6.94975C2 6.06722 2 5.62595 2.06935 5.25839C2.37464 3.64031 3.64031 2.37464 5.25839 2.06935C5.62595 2 6.06722 2 6.94975 2C7.33642 2 7.52976 2 7.71557 2.01738C8.51665 2.09229 9.27652 2.40704 9.89594 2.92051C10.0396 3.03961 10.1763 3.17633 10.4497 3.44975L11 4C11.8158 4.81578 12.2237 5.22367 12.7121 5.49543C12.9804 5.64471 13.2651 5.7626 13.5604 5.84678C14.0979 6 14.6747 6 15.8284 6H16.2021C18.8345 6 20.1506 6 21.0062 6.76946C21.0849 6.84024 21.1598 6.91514 21.2305 6.99383C22 7.84935 22 9.16554 22 11.7979V14C22 17.7712 22 19.6569 20.8284 20.8284C19.6569 22 17.7712 22 14 22H10C6.22876 22 4.34315 22 3.17157 20.8284C2 19.6569 2 17.7712 2 14V6.94975Z" stroke="#fc03cf" stroke-width="1.5"/>
          <path d="M12.9524 11.8852C13.1907 11.8072 13.4471 11.7647 13.7143 11.7647C13.9762 11.7647 14.2277 11.8055 14.462 11.8806M10.0465 12.8533C9.939 12.8338 9.82793 12.8235 9.71429 12.8235C8.76751 12.8235 8 13.5346 8 14.4118C8 15.2889 8.76751 16 9.71429 16H13.7143C14.9767 16 16 15.0519 16 13.8824C16 12.9554 15.3572 12.1676 14.462 11.8806M10.0465 12.8533C9.95482 12.6242 9.90476 12.3763 9.90476 12.1176C9.90476 10.9481 10.9281 10 12.1905 10C13.3664 10 14.3348 10.8226 14.462 11.8806M10.0465 12.8533C10.2722 12.8944 10.4821 12.9765 10.6667 13.091" stroke="#fc03cf" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
        My Files
      </h2>
      <button id="sidebarCloseMobile" class="lg:hidden text-gray-400 hover:text-white transition-colors">
        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
    
    <div class="sidebar-content">
      <!-- Sidebar Loader -->
      <div id="sidebarLoader" class="element-loader" style="position: relative; background: transparent;">
        <div class="skeleton skeleton-text" style="width: 80%;"></div>
        <div class="skeleton skeleton-text" style="width: 65%;"></div>
        <div class="skeleton skeleton-text" style="width: 90%;"></div>
        <div class="skeleton skeleton-text" style="width: 70%;"></div>
        <div class="skeleton skeleton-text" style="width: 85%;"></div>
      </div>
      <ul id="fileList" class="space-y-2 hidden">
        <!-- Files will be populated here -->
      </ul>
    </div>
  </aside>

  <!-- Custom Context Menu for Files -->
  <div id="fileContextMenu" class="hidden fixed z-50 min-w-[180px] bg-gray-800 border border-gray-700 rounded-lg shadow-lg py-2 px-2 animate-fade-in">
    <button id="contextCopyLink" class="flex items-center w-full gap-3 px-4 py-2.5 rounded-md hover:bg-gray-700 text-white text-sm font-medium transition-colors">
      <svg width="18" height="18" fill="none" stroke="#fc03cf" stroke-width="2" viewBox="0 0 24 24" class="flex-shrink-0"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15V5a2 2 0 0 1 2-2h10"/></svg>
      Copy Link
    </button>
    <button id="contextRemove" class="flex items-center w-full gap-3 px-4 py-2.5 rounded-md hover:bg-red-900/30 text-red-400 text-sm font-medium transition-colors">
      <svg width="18" height="18" fill="none" stroke="#ef4444" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="flex-shrink-0">
        <rect x="3" y="6" width="18" height="15" rx="2" stroke="#ef4444" stroke-width="2"/>
        <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" stroke="#ef4444" stroke-width="2"/>
        <line x1="10" y1="11" x2="10" y2="17" stroke="#ef4444" stroke-width="2"/>
        <line x1="14" y1="11" x2="14" y2="17" stroke="#ef4444" stroke-width="2"/>
        <line x1="3" y1="6" x2="21" y2="6" stroke="#ef4444" stroke-width="2"/>
      </svg>
      Remove
    </button>
  </div>

  <!-- Main content wrapper -->
  <div id="mainContent" class="flex flex-col items-center justify-start min-h-screen p-6 pt-20 sm:pt-24 transition-all duration-300" style="margin-left: 250px;">
  <!-- Login Button oben rechts -->
  <div id="loginBtnContainer" class="fixed top-6 right-6 z-50 flex items-center gap-3">
    <a id="accountBtn" href="/user/account" class="hidden px-5 py-2.5 bg-gray-800 text-white rounded-lg shadow-sm hover:bg-gray-700 border border-gray-700 transition-colors duration-200">
      <span class="flex items-center gap-2 font-medium text-sm">
        <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
          <path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
        </svg>
        Account
      </span>
    </a>
    <button id="showLoginBtn" class="px-5 py-2.5 bg-gray-800 text-white rounded-lg shadow-sm hover:bg-gray-700 border border-gray-700 transition-colors duration-200">
      <span class="flex items-center gap-2 font-medium text-sm">
        <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
        </svg>
        Login
      </span>
    </button>
    <button id="disclaimer" class="px-5 py-2.5 bg-gray-700 text-white rounded-lg shadow-sm hidden border border-gray-600">Oops, that not public :(</button>
    <div id="loginDropdown" class="hidden mt-3 bg-gray-800 border border-gray-700 rounded-lg shadow-lg p-6 flex flex-col gap-3 animate-fade-in absolute right-0 top-full" style="min-width:280px;">
      <div class="text-center mb-2">
        <h3 class="text-lg font-semibold text-white">Access Required</h3>
        <p class="text-sm text-gray-400">Enter password to continue</p>
      </div>
      <input id="loginPasswordInput" type="password" placeholder="Access password" class="p-3 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition-all text-white bg-gray-700 placeholder-gray-400" autocomplete="current-password" style="--tw-ring-color: #fc03cf;">
      <button id="loginSubmitBtn" class="px-4 py-3 bg-pink-600 text-white rounded-lg hover:bg-pink-700 transition-colors duration-200 font-medium" style="background-color: #fc03cf;">Submit</button>
      <button id="loginCancelBtn" class="text-sm text-gray-400 hover:text-white hover:underline transition-colors">Close</button>
    </div>
  </div>

  <script>
    // Sidebar resize and toggle functionality
    document.addEventListener('DOMContentLoaded', function() {
      const sidebar = document.getElementById('filesSidebar');
      const resizer = document.getElementById('sidebarResizer');
      const mainContent = document.getElementById('mainContent');
      const toggleMobile = document.getElementById('sidebarToggleMobile');
      const closeMobile = document.getElementById('sidebarCloseMobile');
      
      let isResizing = false;
      let lastX = 0;

      if (window.innerWidth > 1024) {
        mainContent.style.marginLeft = sidebar.offsetWidth + 'px';
        sidebar.classList.remove('open');
      } else {
        mainContent.style.marginLeft = '0';
      }
      
      // Desktop: Resizable sidebar
      resizer.addEventListener('mousedown', function(e) {
        if (window.innerWidth > 1024) {
          isResizing = true;
          lastX = e.clientX;
          resizer.classList.add('resizing');
          document.body.style.cursor = 'ew-resize';
          document.body.style.userSelect = 'none';
        }
      });
      
      document.addEventListener('mousemove', function(e) {
        if (!isResizing || window.innerWidth <= 1024) return;
        
        const currentWidth = sidebar.offsetWidth;
        const newWidth = currentWidth + (e.clientX - lastX);
        
        // Limit width between 100px and 300px
        if (newWidth >= 100 && newWidth <= 300) {
          sidebar.style.width = newWidth + 'px';
          mainContent.style.marginLeft = newWidth + 'px';
        }
        
        lastX = e.clientX;
      });

      
      
      document.addEventListener('mouseup', function() {
        if (isResizing) {
          isResizing = false;
          resizer.classList.remove('resizing');
          document.body.style.cursor = '';
          document.body.style.userSelect = '';
        }
      });
      
      // Mobile: Toggle sidebar
      toggleMobile.addEventListener('click', function() {
        sidebar.classList.add('open');
        toggleMobile.classList.add('sidebar-open');
      });
      
      closeMobile.addEventListener('click', function() {
        sidebar.classList.remove('open');
        toggleMobile.classList.remove('sidebar-open');
      });
      
      // Close sidebar when clicking outside on mobile
      document.addEventListener('click', function(e) {
        if (window.innerWidth <= 1024 && 
            sidebar.classList.contains('open') &&
            !sidebar.contains(e.target) && 
            !toggleMobile.contains(e.target)) {
          sidebar.classList.remove('open');
          toggleMobile.classList.remove('sidebar-open');
        }
      });
      
      // Adjust main content margin on window resize
      window.addEventListener('resize', function() {
        if (window.innerWidth > 1024) {
          mainContent.style.marginLeft = sidebar.offsetWidth + 'px';
          sidebar.classList.remove('open');
        } else {
          mainContent.style.marginLeft = '0';
        }
      });
    });
  </script>
  <script>
  // Context Menu Logic for My Files
  document.addEventListener('DOMContentLoaded', function() {
    const fileList = document.getElementById('fileList');
    const contextMenu = document.getElementById('fileContextMenu');
    let contextTarget = null;
    // Show context menu on right click
    fileList.addEventListener('contextmenu', function(e) {
      const li = e.target.closest('.fileLi');
      if (!li) return;
      e.preventDefault();
      contextTarget = li;
      contextMenu.style.top = e.clientY + 'px';
      contextMenu.style.left = e.clientX + 'px';
      contextMenu.classList.remove('hidden');
      setTimeout(() => {
        document.addEventListener('mousedown', closeContextMenu, { once: true });
      }, 0);
    });
    function closeContextMenu(e) {
      if (!contextMenu.contains(e.target)) {
        contextMenu.classList.add('hidden');
        contextTarget = null;
      }
    }
    // Copy Link
    document.getElementById('contextCopyLink').onclick = function() {
      if (contextTarget) {
        const aTag = contextTarget.querySelector('a');
        const link = aTag ? aTag.href : '';
        if (link) {
          navigator.clipboard.writeText(link);
          contextMenu.classList.add('hidden');
        }
      }
    };
    // Remove
    document.getElementById('contextRemove').onclick = function() {
      if (contextTarget) {
        removeSelectedFile(contextTarget);
      }
    };
  });
  </script>
  <style>
    @keyframes fade-in { from { opacity: 0; transform: translateY(-10px);} to { opacity: 1; transform: none;}}
    .animate-fade-in { animation: fade-in 0.2s; }
  </style>
  <script>
    // Login Button Dropdown-Logik
    document.addEventListener('DOMContentLoaded', function() {
      const showBtn = document.getElementById('showLoginBtn');
      const dropdown = document.getElementById('loginDropdown');
      const submitBtn = document.getElementById('loginSubmitBtn');
      const cancelBtn = document.getElementById('loginCancelBtn');
      const pwInput = document.getElementById('loginPasswordInput');
      const disclaimerBtn = document.getElementById('disclaimer');
      let isOpen = false;
      showBtn.onclick = function() {
        dropdown.classList.remove('hidden');
        pwInput.value = '';
        pwInput.focus();
        isOpen = true;
        disclaimerBtn.classList.remove('hidden');
      };
      cancelBtn.onclick = function() {
        dropdown.classList.add('hidden');
        isOpen = false;
      };
      pwInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') submitBtn.click();
      });
      submitBtn.onclick = async function() {
        const pw = pwInput.value;
        if (!pw) return;
        submitBtn.disabled = true;
        submitBtn.textContent = 'Checking...';
        try {
          const res = await fetch(`/user/login?login_password=${encodeURIComponent(pw)}`);
          if (res.status === 404) {
            submitBtn.disabled = true;
            submitBtn.textContent = 'Wrong Password';
          } else if (res.status === 200) {
            window.location.href = `/user/login?login_password=${encodeURIComponent(pw)}`;
            return;
          } else {
            showError('Serverfehler ('+res.status+")");
          }
        } catch (e) {
          showError('Server nicht erreichbar');
        } finally {
            setTimeout(() => {
              submitBtn.disabled = false;
              submitBtn.textContent = 'Submit';
            }, 2000);
        }
      };
      // Schließe Dropdown bei Klick außerhalb
      document.addEventListener('mousedown', function(e) {
        if (isOpen && !dropdown.contains(e.target) && !showBtn.contains(e.target)) {
          dropdown.classList.add('hidden');
          isOpen = false;
          disclaimerBtn.classList.add('hidden');
        }
      });
    });
  </script>
  <div class="popup fixed inset-0 flex items-center justify-center hidden z-50" id="popup">
    <div class="absolute inset-0 bg-black/70"></div>
    <div class="relative rounded-lg border border-red-800 bg-gray-800 max-w-md mx-4 shadow-xl p-8 popup-content" role="alert" style="transform: scale(0.8); opacity: 0; transition: transform 0.25s cubic-bezier(.4,2,.6,1), opacity 0.25s;">
      <div class="flex items-center gap-4 mb-4">
        <span class="rounded-full p-3 bg-red-900/30">
          <svg width="28" height="28" fill="#ef4444" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M11 7h2v7h-2zm0 8h2v2h-2z"/><path d="m21.707 7.293-5-5A.996.996 0 0 0 16 2H8a.996.996 0 0 0-.707.293l-5 5A.996.996 0 0 0 2 8v8c0 .266.105.52.293.707l5 5A.996.996 0 0 0 8 22h8c.266 0 .52-.105.707-.293l5-5A.996.996 0 0 0 22 16V8a.996.996 0 0 0-.293-.707zM20 15.586 15.586 20H8.414L4 15.586V8.414L8.414 4h7.172L20 8.414v7.172z"/></svg>
        </span>
        <p class="font-bold text-xl text-white" id="err.title">Error Occurred</p>
      </div>
      <p class="text-gray-300 mb-6 leading-relaxed" id="err.message">
        The error message is non-existent. An error while displaying an error message.. how ironic.
      </p>
      <button onclick="closePopup()" class="w-full px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors duration-200 font-medium">Close</button>
    </div>
  </div>
  
  <!-- Permanent Upload Confirmation Popup -->
  <div class="popup fixed inset-0 flex items-center justify-center hidden z-50" id="permanentUploadPopup">
    <div class="absolute inset-0 bg-black/70"></div>
    <div class="relative rounded-lg border border-pink-500 bg-gray-800 max-w-md mx-4 shadow-xl p-8 popup-content" role="dialog" style="transform: scale(0.8); opacity: 0; transition: transform 0.25s cubic-bezier(.4,2,.6,1), opacity 0.25s;">
      <div class="flex items-center gap-4 mb-4">
        <span class="rounded-full p-3" style="background-color: rgba(252, 3, 207, 0.2);">
          <svg width="28" height="28" fill="#fc03cf" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
          </svg>
        </span>
        <p class="font-bold text-xl text-white">Save Permanently?</p>
      </div>
      <p class="text-gray-300 mb-6 leading-relaxed">
        Ay, this file expires after 3 months *pouf* <br> Would you like to make it permanent?
      </p>
      <div class="flex gap-3">
        <button onclick="confirmPermanentUpload(false)" class="flex-1 px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors duration-200 font-medium">
          No, Temporary
        </button>
        <button onclick="confirmPermanentUpload(true)" class="flex-1 px-6 py-3 text-white rounded-lg hover:bg-pink-700 transition-colors duration-200 font-medium" style="background-color: #fc03cf;">
          Yes, Permanent
        </button>
      </div>
    </div>
  </div>
  
  <div class="w-full max-w-3xl mx-auto mb-6">
    <div class="bg-gray-800 border border-gray-700 shadow-sm rounded-lg p-6 relative">
      <!-- URL Shortener Loader -->
      <div id="urlShortenerLoader" class="element-loader">
        <div class="skeleton skeleton-title" style="width: 50%; margin: 0 auto;"></div>
        <div class="skeleton skeleton-text" style="width: 40%; margin: 0 auto 1.5rem;"></div>
        <div class="skeleton" style="height: 48px; width: 100%;"></div>
      </div>
      <div id="urlShortenerContent" class="hidden">
      <div class="text-center mb-6">
        <h2 class="text-2xl font-bold text-white mb-1">Short it!</h2>
        <p class="text-sm text-gray-400">Create short links instantly</p>
      </div>
      <div class="flex space-x-2 mb-4">
        <input id="urlInput" type="text" placeholder="Enter URL to shorten" class="flex-1 p-3 border border-gray-600 rounded-lg bg-gray-700 text-white text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:border-pink-500 transition-all" onkeypress="if(event.key === 'Enter') shortenUrl()" style="--tw-ring-color: #fc03cf;">
        <button onclick="shortenUrl()" class="flex items-center gap-2 px-6 py-3 text-white text-sm rounded-lg hover:bg-pink-700 transition-colors duration-200 font-medium" style="background-color: #fc03cf;">
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
            <path d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v7.5A2.25 2.25 0 0 0 5.25 18h7.5A2.25 2.25 0 0 0 15 15.75V7.5L13.5 6Z"/>
            <path d="M10.5 3.75L6.75 3.75A1.5 1.5 0 0 0 5.25 5.25v7.5"/>
          </svg>
          Shorten
        </button>
      </div>
      <div id="shortUrlContainer" class="hidden p-3 bg-gray-700 border border-gray-600 rounded-lg flex items-center justify-between">
        <span id="shortened" class="text-white font-mono text-sm"></span>
        <button onclick="copyText('shortened')" class="px-2 py-2 bg-gray-600 hover:bg-gray-500 rounded-lg transition-colors duration-200">
          <svg id="copyshortenedsvg" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" onclick="copyText('shortened')">
            <path d="M14 7V7C14 6.06812 14 5.60218 13.8478 5.23463C13.6448 4.74458 13.2554 4.35523 12.7654 4.15224C12.3978 4 11.9319 4 11 4H8C6.11438 4 5.17157 4 4.58579 4.58579C4 5.17157 4 6.11438 4 8V11C4 11.9319 4 12.3978 4.15224 12.7654C4.35523 13.2554 4.74458 13.6448 5.23463 13.8478C5.60218 14 6.06812 14 7 14V14" stroke="#fc03cf" stroke-width="2"/>
            <rect x="10" y="10" width="10" height="10" rx="2" stroke="#fc03cf" stroke-width="2"/>
          </svg>
        </button>
      </div>
      <div id="jsonResponseContainer" class="hidden p-3 bg-gray-700 border border-gray-600 rounded-lg mt-3">
        <pre id="jsonResponse" class="text-xs text-gray-300 font-mono"></pre>
      </div>
      </div>
    </div>
  </div>
  
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 w-full max-w-5xl mx-auto">
    <div class="min-w-0">
      <!-- File Sharing Block -->
  <div class="bg-gray-800 border border-gray-700 shadow-sm rounded-lg p-6 h-full relative">
        <!-- File Sharing Loader -->
        <div id="fileSharingLoader" class="element-loader">
          <div class="skeleton skeleton-title" style="width: 60%; margin: 0 auto;"></div>
          <div class="skeleton skeleton-text" style="width: 50%; margin: 0 auto 1.5rem;"></div>
          <div class="skeleton skeleton-box"></div>
        </div>
        <div id="fileSharingContent" class="hidden">
        <div class="text-center mb-6">
          <h2 class="text-xl font-bold text-white mb-1">File Sharing</h2>
          <p class="text-sm text-gray-400">Upload and share files securely</p>
        </div>
        <div class="container" id="fileUploadContainer">
          <div class="header">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier">
              <path d="M7 10V9C7 6.23858 9.23858 4 12 4C14.7614 4 17 6.23858 17 9V10C19.2091 10 21 11.7909 21 14C21 15.4806 20.1956 16.8084 19 17.5M7 10C4.79086 10 3 11.7909 3 14C3 15.4806 3.8044 16.8084 5 17.5M7 10C7.43285 10 7.84965 10.0688 8.24006 10.1959M12 12V21M12 12L15 15M12 12L9 15" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </g></svg>
            <p>Browse File to upload! (max. 1GB)</p>
          </div>
          <label for="fileUpload" class="footer">
            <svg fill="#000000" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M15.331 6H8.5v20h15V14.154h-8.169z"></path><path d="M18.153 6h-.009v5.342H23.5v-.002z"></path></g></svg>
            <p id="fileUploadLabel">No file selected</p>
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier">
              <path d="M5.16565 10.1534C5.07629 8.99181 5.99473 8 7.15975 8H16.8402C18.0053 8 18.9237 8.9918 18.8344 10.1534L18.142 19.1534C18.0619 20.1954 17.193 21 16.1479 21H7.85206C6.80699 21 5.93811 20.1954 5.85795 19.1534L5.16565 10.1534Z" stroke="#000000" stroke-width="2"></path>
              <path d="M19.5 5H4.5" stroke="#000000" stroke-width="2" stroke-linecap="round"></path>
              <path d="M10 3C10 2.44772 10.4477 2 11 2H13C13.5523 2 14 2.44772 14 3V5H10V3Z" stroke="#000000" stroke-width="2"></path>
            </g></svg>
          </label>
          <input id="fileUpload" type="file" style="display: none;" onchange="uploadFile()">
        </div>
        <div id="permanentUploadContainer" class="hidden mt-3 flex items-center gap-3 p-3 bg-gray-700 border border-gray-600 rounded-lg">
          <input type="checkbox" id="permanentUpload" name="permanentUpload" class="peer appearance-none h-4 w-4 border-2 border-gray-500 rounded transition-all duration-150 focus:outline-none focus:ring-2 focus:ring-pink-500 relative" style="--tw-ring-color: #fc03cf;">
          <svg class="absolute pointer-events-none ml-1 mt-0.5 w-2.5 h-2.5 text-white opacity-0 peer-checked:opacity-100 transition-opacity duration-150" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24">
            <path d="M5 13l4 4L19 7" />
          </svg>
          <label for="permanentUpload" class="text-xs text-gray-300 select-none cursor-pointer font-medium">Save file permanently</label>
        </div>
        <div id="uploadProgressContainer" class="w-full bg-gray-700 rounded-lg h-7 mt-4 hidden border border-gray-600 overflow-hidden">
          <div id="uploadProgress" class="h-7 rounded-lg text-center text-white transition-all duration-300 ease-out flex items-center justify-center relative" style="width: 0%; background-color: #fc03cf;">
            <span id="uploadProgressPercentage" class="font-bold text-xs z-10">0%</span>
            <span id="estTime" class="text-white text-xs ml-2 z-10"></span>
          </div>
        </div>
        <div id="fileUrlContainer" class="hidden cursor-pointer p-4 bg-gray-700 border border-gray-600 rounded-lg flex items-center justify-between mt-6 hover:bg-gray-600 transition-colors duration-200" onclick="copyText('fileurl')">
          <span id="fileurl" class="text-white font-mono text-sm truncate mr-3"></span>
          <button id="copyFileUrl" onclick="copyText('fileurl')" class="px-3 py-2 bg-gray-600 hover:bg-gray-500 rounded-lg cursor-pointer transition-colors duration-200 flex-shrink-0">
            <svg id="copyfilesvg" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" onclick="copyText('fileurl')">
              <path d="M14 7V7C14 6.06812 14 5.60218 13.8478 5.23463C13.6448 4.74458 13.2554 4.35523 12.7654 4.15224C12.3978 4 11.9319 4 11 4H8C6.11438 4 5.17157 4 4.58579 4.58579C4 5.17157 4 6.11438 4 8V11C4 11.9319 4 12.3978 4.15224 12.7654C4.35523 13.2554 4.74458 13.6448 5.23463 13.8478C5.60218 14 6.06812 14 7 14V14" stroke="#fc03cf" stroke-width="2"/>
              <rect x="10" y="10" width="10" height="10" rx="2" stroke="#fc03cf" stroke-width="2"/>
            </svg>
          </button>
        </div>
        </div>
    </div>
  </div>
  <div class="min-w-0">
      <!-- File Converter Block -->
  <div class="bg-gray-800 border border-gray-700 shadow-sm rounded-lg p-6 h-full relative">
        <!-- File Converter Loader -->
        <div id="fileConverterLoader" class="element-loader">
          <div class="skeleton skeleton-title" style="width: 60%; margin: 0 auto;"></div>
          <div class="skeleton skeleton-text" style="width: 50%; margin: 0 auto 1.5rem;"></div>
          <div class="skeleton skeleton-box"></div>
          <div class="skeleton" style="height: 48px; width: 100%; margin-top: 1rem;"></div>
        </div>
        <div id="fileConverterContent" class="hidden">
        <div class="text-center mb-6">
          <h2 class="text-xl font-bold text-white mb-2">File Converter</h2>
          <p class="text-sm text-gray-400">Convert files to different formats</p>
        </div>
        <form id="fileConvertForm" class="flex flex-col space-y-3" onsubmit="convertFile(event)">
          <div class="container" id="fileConvertContainer">
            <div class="header">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier">
                <path d="M7 10V9C7 6.23858 9.23858 4 12 4C14.7614 4 17 6.23858 17 9V10C19.2091 10 21 11.7909 21 14C21 15.4806 20.1956 16.8084 19 17.5M7 10C4.79086 10 3 11.7909 3 14C3 15.4806 3.8044 16.8084 5 17.5M7 10C7.43285 10 7.84965 10.0688 8.24006 10.1959M12 12V21M12 12L15 15M12 12L9 15" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
              </g></svg>
              <p>Browse File to convert! (max. 1GB)</p>
            </div>
            <label for="convertFileInput" class="footer">
              <svg fill="#000000" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M15.331 6H8.5v20h15V14.154h-8.169z"></path><path d="M18.153 6h-.009v5.342H23.5v-.002z"></path></g></svg>
              <p id="convertFileLabel">No file selected</p>
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier">
                <path d="M5.16565 10.1534C5.07629 8.99181 5.99473 8 7.15975 8H16.8402C18.0053 8 18.9237 8.9918 18.8344 10.1534L18.142 19.1534C18.0619 20.1954 17.193 21 16.1479 21H7.85206C6.80699 21 5.93811 20.1954 5.85795 19.1534L5.16565 10.1534Z" stroke="#000000" stroke-width="2"></path>
                <path d="M19.5 5H4.5" stroke="#000000" stroke-width="2" stroke-linecap="round"></path>
                <path d="M10 3C10 2.44772 10.4477 2 11 2H13C13.5523 2 14 2.44772 14 3V5H10V3Z" stroke="#000000" stroke-width="2"></path>
              </g></svg>
            </label>
            <input id="convertFileInput" type="file" style="display: none;" required>
          </div>
          <div class="hidden mt-3 flex items-center gap-3 p-3 bg-gray-700 border border-gray-600 rounded-lg" id="convertPermanentContainer">
            <input type="checkbox" id="convertPermanent" name="convertPermanent" class="peer appearance-none h-4 w-4 border-2 border-gray-500 rounded transition-all duration-150 focus:outline-none focus:ring-2 focus:ring-pink-500 relative" style="--tw-ring-color: #fc03cf;">
            <svg class="absolute pointer-events-none ml-1 mt-0.5 w-2.5 h-2.5 text-white opacity-0 peer-checked:opacity-100 transition-opacity duration-150" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24">
              <path d="M5 13l4 4L19 7" />
            </svg>
            <label for="convertPermanent" class="text-xs text-gray-300 select-none cursor-pointer font-medium">Save converted file permanently</label>
          </div>
          
          <div class="flex flex-col mt-4">
            <label for="extensionSelect" class="mb-2 font-medium text-sm text-gray-300">Convert to extension</label>
            <div class="format-selector">
              <div class="format-display" onclick="toggleFormatMenu()">
                <span id="selectedFormat">Select extension</span>
                <svg class="format-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
              <div class="format-menu hidden" id="formatMenu">
                <div class="format-category">
                  <div class="category-header">Video Formats</div>
                  <div class="format-options">
                    <div class="format-option" data-value="mp4"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="display:inline;vertical-align:middle;margin-right:4px;"><rect x="3" y="5" width="18" height="14" rx="2" stroke="#007bff" stroke-width="2"/><rect x="7" y="9" width="10" height="6" rx="1" fill="#007bff" opacity="0.2"/></svg>MP4</div>
                    <div class="format-option" data-value="mov"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="display:inline;vertical-align:middle;margin-right:4px;"><rect x="3" y="5" width="18" height="14" rx="2" stroke="#007bff" stroke-width="2"/><rect x="7" y="9" width="10" height="6" rx="1" fill="#007bff" opacity="0.2"/></svg>MOV</div>
                    <div class="format-option" data-value="avi"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="display:inline;vertical-align:middle;margin-right:4px;"><rect x="3" y="5" width="18" height="14" rx="2" stroke="#007bff" stroke-width="2"/><rect x="7" y="9" width="10" height="6" rx="1" fill="#007bff" opacity="0.2"/></svg>AVI</div>
                    <div class="format-option" data-value="mkv"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="display:inline;vertical-align:middle;margin-right:4px;"><rect x="3" y="5" width="18" height="14" rx="2" stroke="#007bff" stroke-width="2"/><rect x="7" y="9" width="10" height="6" rx="1" fill="#007bff" opacity="0.2"/></svg>MKV</div>
                    <div class="format-option" data-value="webm"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="display:inline;vertical-align:middle;margin-right:4px;"><rect x="3" y="5" width="18" height="14" rx="2" stroke="#007bff" stroke-width="2"/><rect x="7" y="9" width="10" height="6" rx="1" fill="#007bff" opacity="0.2"/></svg>WEBM</div>
                    <div class="format-option" data-value="flv"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="display:inline;vertical-align:middle;margin-right:4px;"><rect x="3" y="5" width="18" height="14" rx="2" stroke="#007bff" stroke-width="2"/><rect x="7" y="9" width="10" height="6" rx="1" fill="#007bff" opacity="0.2"/></svg>FLV</div>
                    <div class="format-option" data-value="wmv"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="display:inline;vertical-align:middle;margin-right:4px;"><rect x="3" y="5" width="18" height="14" rx="2" stroke="#007bff" stroke-width="2"/><rect x="7" y="9" width="10" height="6" rx="1" fill="#007bff" opacity="0.2"/></svg>WMV</div>
                    <div class="format-option" data-value="mpeg"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="display:inline;vertical-align:middle;margin-right:4px;"><rect x="3" y="5" width="18" height="14" rx="2" stroke="#007bff" stroke-width="2"/><rect x="7" y="9" width="10" height="6" rx="1" fill="#007bff" opacity="0.2"/></svg>MPEG</div>
                    <div class="format-option" data-value="mpg"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="display:inline;vertical-align:middle;margin-right:4px;"><rect x="3" y="5" width="18" height="14" rx="2" stroke="#007bff" stroke-width="2"/><rect x="7" y="9" width="10" height="6" rx="1" fill="#007bff" opacity="0.2"/></svg>MPG</div>
                    <div class="format-option" data-value="3gp"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="display:inline;vertical-align:middle;margin-right:4px;"><rect x="3" y="5" width="18" height="14" rx="2" stroke="#007bff" stroke-width="2"/><rect x="7" y="9" width="10" height="6" rx="1" fill="#007bff" opacity="0.2"/></svg>3GP</div>
                  </div>
                </div>
                <div class="format-category">
                  <div class="category-header">Audio Formats</div>
                  <div class="format-options">
                    <div class="format-option" data-value="mp3"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="display:inline;vertical-align:middle;margin-right:4px;"><path d="M9 17V5l12-2v12" stroke="#28a745" stroke-width="2"/><circle cx="6" cy="17" r="3" stroke="#28a745" stroke-width="2"/><circle cx="18" cy="15" r="3" stroke="#28a745" stroke-width="2"/></svg>MP3</div>
                    <div class="format-option" data-value="wav"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="display:inline;vertical-align:middle;margin-right:4px;"><path d="M9 17V5l12-2v12" stroke="#28a745" stroke-width="2"/><circle cx="6" cy="17" r="3" stroke="#28a745" stroke-width="2"/><circle cx="18" cy="15" r="3" stroke="#28a745" stroke-width="2"/></svg>WAV</div>
                    <div class="format-option" data-value="aac"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="display:inline;vertical-align:middle;margin-right:4px;"><path d="M9 17V5l12-2v12" stroke="#28a745" stroke-width="2"/><circle cx="6" cy="17" r="3" stroke="#28a745" stroke-width="2"/><circle cx="18" cy="15" r="3" stroke="#28a745" stroke-width="2"/></svg>AAC</div>
                    <div class="format-option" data-value="flac"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="display:inline;vertical-align:middle;margin-right:4px;"><path d="M9 17V5l12-2v12" stroke="#28a745" stroke-width="2"/><circle cx="6" cy="17" r="3" stroke="#28a745" stroke-width="2"/><circle cx="18" cy="15" r="3" stroke="#28a745" stroke-width="2"/></svg>FLAC</div>
                    <div class="format-option" data-value="m4a"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="display:inline;vertical-align:middle;margin-right:4px;"><path d="M9 17V5l12-2v12" stroke="#28a745" stroke-width="2"/><circle cx="6" cy="17" r="3" stroke="#28a745" stroke-width="2"/><circle cx="18" cy="15" r="3" stroke="#28a745" stroke-width="2"/></svg>M4A</div>
                    <div class="format-option" data-value="opus"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="display:inline;vertical-align:middle;margin-right:4px;"><path d="M9 17V5l12-2v12" stroke="#28a745" stroke-width="2"/><circle cx="6" cy="17" r="3" stroke="#28a745" stroke-width="2"/><circle cx="18" cy="15" r="3" stroke="#28a745" stroke-width="2"/></svg>OPUS</div>
                    <div class="format-option" data-value="ogg"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="display:inline;vertical-align:middle;margin-right:4px;"><path d="M9 17V5l12-2v12" stroke="#28a745" stroke-width="2"/><circle cx="6" cy="17" r="3" stroke="#28a745" stroke-width="2"/><circle cx="18" cy="15" r="3" stroke="#28a745" stroke-width="2"/></svg>OGG</div>
                    <div class="format-option" data-value="wma"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="display:inline;vertical-align:middle;margin-right:4px;"><path d="M9 17V5l12-2v12" stroke="#28a745" stroke-width="2"/><circle cx="6" cy="17" r="3" stroke="#28a745" stroke-width="2"/><circle cx="18" cy="15" r="3" stroke="#28a745" stroke-width="2"/></svg>WMA</div>
                  </div>
                </div>
                <div class="format-category">
                  <div class="category-header">Image Formats</div>
                  <div class="format-options">
                    <div class="format-option" data-value="jpg"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="display:inline;vertical-align:middle;margin-right:4px;"><rect x="3" y="5" width="18" height="14" rx="2" stroke="#fd7e14" stroke-width="2"/><circle cx="8" cy="10" r="2" stroke="#fd7e14" stroke-width="2"/><path d="M21 19l-5-5-4 4-3-3-4 4" stroke="#fd7e14" stroke-width="2"/></svg>JPG</div>
                    <div class="format-option" data-value="jpeg"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="display:inline;vertical-align:middle;margin-right:4px;"><rect x="3" y="5" width="18" height="14" rx="2" stroke="#fd7e14" stroke-width="2"/><circle cx="8" cy="10" r="2" stroke="#fd7e14" stroke-width="2"/><path d="M21 19l-5-5-4 4-3-3-4 4" stroke="#fd7e14" stroke-width="2"/></svg>JPEG</div>
                    <div class="format-option" data-value="png"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="display:inline;vertical-align:middle;margin-right:4px;"><rect x="3" y="5" width="18" height="14" rx="2" stroke="#fd7e14" stroke-width="2"/><circle cx="8" cy="10" r="2" stroke="#fd7e14" stroke-width="2"/><path d="M21 19l-5-5-4 4-3-3-4 4" stroke="#fd7e14" stroke-width="2"/></svg>PNG</div>
                    <div class="format-option" data-value="gif"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="display:inline;vertical-align:middle;margin-right:4px;"><rect x="3" y="5" width="18" height="14" rx="2" stroke="#fd7e14" stroke-width="2"/><circle cx="8" cy="10" r="2" stroke="#fd7e14" stroke-width="2"/><path d="M21 19l-5-5-4 4-3-3-4 4" stroke="#fd7e14" stroke-width="2"/></svg>GIF</div>
                    <div class="format-option" data-value="bmp"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="display:inline;vertical-align:middle;margin-right:4px;"><rect x="3" y="5" width="18" height="14" rx="2" stroke="#fd7e14" stroke-width="2"/><circle cx="8" cy="10" r="2" stroke="#fd7e14" stroke-width="2"/><path d="M21 19l-5-5-4 4-3-3-4 4" stroke="#fd7e14" stroke-width="2"/></svg>BMP</div>
                    <div class="format-option" data-value="tiff"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="display:inline;vertical-align:middle;margin-right:4px;"><rect x="3" y="5" width="18" height="14" rx="2" stroke="#fd7e14" stroke-width="2"/><circle cx="8" cy="10" r="2" stroke="#fd7e14" stroke-width="2"/><path d="M21 19l-5-5-4 4-3-3-4 4" stroke="#fd7e14" stroke-width="2"/></svg>TIFF</div>
                    <div class="format-option" data-value="webp"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="display:inline;vertical-align:middle;margin-right:4px;"><rect x="3" y="5" width="18" height="14" rx="2" stroke="#fd7e14" stroke-width="2"/><circle cx="8" cy="10" r="2" stroke="#fd7e14" stroke-width="2"/><path d="M21 19l-5-5-4 4-3-3-4 4" stroke="#fd7e14" stroke-width="2"/></svg>WEBP</div>
                    <div class="format-option" data-value="ico"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="display:inline;vertical-align:middle;margin-right:4px;"><rect x="3" y="5" width="18" height="14" rx="2" stroke="#fd7e14" stroke-width="2"/><circle cx="8" cy="10" r="2" stroke="#fd7e14" stroke-width="2"/><path d="M21 19l-5-5-4 4-3-3-4 4" stroke="#fd7e14" stroke-width="2"/></svg>ICO</div>
                  </div>
                </div>
              </div>
            </div>
            <input type="hidden" id="extensionSelect" name="extensionSelect" required>
          </div>
          <button type="submit" class="w-full px-4 py-3 text-sm text-white rounded-lg hover:bg-pink-700 transition-colors duration-200 font-medium" style="background-color: #fc03cf;">
            <span class="flex items-center justify-center gap-2">
              <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                <path d="M16 12V6a2 2 0 0 0-2-2H3v2h11v6h-2l3 4 3-4h-2Z"/>
                <path d="M8 12V6H6v6H4l3 4 3-4H8Z"/>
              </svg>
              Convert File
            </span>
          </button>
        </form>
        <div id="convertResult" class="hidden mt-6 p-4 bg-gray-700 border border-gray-600 rounded-lg flex items-center justify-between">
          <span id="convertedFileLink" class="text-white font-mono text-sm truncate mr-3"></span>
          <div class="flex gap-2 flex-shrink-0">
            <button onclick="copyText('convertedFileLink')" class="px-3 py-2 bg-gray-600 hover:bg-gray-500 rounded-lg transition-colors duration-200">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M14 7V7C14 6.06812 14 5.60218 13.8478 5.23463C13.6448 4.74458 13.2554 4.35523 12.7654 4.15224C12.3978 4 11.9319 4 11 4H8C6.11438 4 5.17157 4 4.58579 4.58579C4 5.17157 4 6.11438 4 8V11C4 11.9319 4 12.3978 4.15224 12.7654C4.35523 13.2554 4.74458 13.6448 5.23463 13.8478C5.60218 14 6.06812 14 7 14V14" stroke="#fc03cf" stroke-width="2"/>
                <rect x="10" y="10" width="10" height="10" rx="2" stroke="#fc03cf" stroke-width="2"/>
              </svg>
            </button>
            <button onclick="downloadConvertedFile()" class="px-3 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors duration-200">
              <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 16a1 1 0 0 1-1-1V5a1 1 0 1 1 2 0v10a1 1 0 0 1-1 1zm-4.707-3.707a1 1 0 0 1 1.414 0L11 14.586V5a1 1 0 1 1 2 0v9.586l2.293-2.293a1 1 0 1 1 1.414 1.414l-4 4a1 1 0 0 1-1.414 0l-4-4a1 1 0 0 1 0-1.414z"/>
                <path d="M5 18a1 1 0 0 1 1-1h12a1 1 0 1 1 0 2H6a1 1 0 0 1-1-1z"/>
              </svg>
            </button>
          </div>
          <script>
          function downloadConvertedFile() {
            const linkElem = document.getElementById('convertedFileLink');
            if (linkElem && linkElem.textContent) {
                let url = linkElem.querySelector('a') ? linkElem.querySelector('a').href : '';
              if (url) {
                if (url.indexOf('?') === -1) {
                  url += '?download=true';
                } else {
                  url += '&download=true';
                }
                window.location.href = url;
              }
            }
          }
          </script>
        </div>
        <div id="convertProgressContainer" class="w-full bg-gray-700 rounded-lg h-7 mt-4 hidden border border-gray-600 overflow-hidden">
          <div id="convertProgress" class="h-7 rounded-lg text-center text-white transition-all duration-300 ease-out flex items-center justify-center relative" style="width: 0%; background-color: #fc03cf;">
            <span id="convertProgressPercentage" class="font-bold text-xs z-10">0%</span>
          </div>
        </div>
        <div id="convertEtaContainer" class="hidden mt-2 text-center text-gray-400">
          <span id="convertEta" class="text-xs"></span>
        </div>
        <div id="convertStatusContainer" class="hidden mt-2 text-center text-gray-400">
          <span id="convertStatus" class="text-xs font-medium"></span>
        </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Footer -->
  <div id="footer" class="mt-12 w-full max-w-6xl mx-auto">
    <div class="flex justify-center mb-5">
      <a href="https://github.com/deutscher775/s.jesn.zip" target="_blank" class="flex items-center gap-2 text-sm text-gray-400 hover:text-white transition-colors duration-200 group">
        <div class="p-2 bg-gray-800 rounded-full group-hover:bg-gray-700 border border-gray-700 transition-colors duration-200">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.477 2 2 6.477 2 12c0 4.418 2.865 8.166 6.839 9.489.5.092.682-.217.682-.482 0-.237-.009-.868-.014-1.703-2.782.604-3.369-1.342-3.369-1.342-.454-1.154-1.11-1.461-1.11-1.461-.908-.62.069-.608.069-.608 1.004.07 1.532 1.032 1.532 1.032.892 1.529 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.983 1.03-2.682-.103-.253-.446-1.27.098-2.645 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0 1 12 6.844c.85.004 1.705.115 2.504.337 1.91-1.296 2.75-1.026 2.75-1.026.544 1.375.201 2.392.099 2.645.64.699 1.03 1.591 1.03 2.682 0 3.842-2.337 4.687-4.565 4.936.36.31.682.92.682 1.852 0 1.338-.012 2.419-.012 2.747 0 .267.18.578.688.48A10.013 10.013 0 0 0 22 12c0-5.523-4.477-10-10-10z"/>
          </svg>
        </div>
        <span class="font-medium">View on GitHub</span>
      </a>
    </div>
    <div class="text-center text-gray-500 text-xs space-y-2 pb-6">
      <p class="font-medium">&copy; 2026 - Present jesn.zip. All rights reserved.</p>
      <p class="flex justify-center gap-5 flex-wrap">
        <a href="/imprint" class="hover:text-white transition-colors hover:underline" style="color: #fc03cf;">Imprint</a> 
        <a href="/privacy.html" class="hover:text-white transition-colors hover:underline" style="color: #fc03cf;">Privacy Policy</a>
        <a href="https://uiverse.io/Yaya12085/yellow-goat-62" class="hover:text-white transition-colors hover:underline" style="color: #fc03cf;">File upload design</a>
      </p>
    </div>
  </div>
</div>
<script>
(function () {
  const overlay = document.getElementById('bootOverlay');
  if (!overlay) return;
  overlay.style.display = 'flex';

  const bar = document.getElementById('bootBar');
  const detail = document.getElementById('bootDetail');
  const steps = ['page','auth','files','ui'];
  const weights = { page: 25, auth: 25, files: 35, ui: 15 };
  const els = {};
  steps.forEach(id => { els[id] = document.querySelector(`.boot-step[data-step="${id}"]`); });
  let progress = 0;

  function setActive(id, stateText = 'running') {
    steps.forEach(s => { if (els[s]) els[s].classList.remove('active'); });
    if (els[id]) {
      els[id].classList.add('active');
      var st = els[id].querySelector('.boot-state');
      if (st) st.textContent = stateText;
    }
  }
  function setDone(id, stateText = 'ok') {
    if (els[id]) {
      els[id].classList.remove('active');
      els[id].classList.add('done');
      var st = els[id].querySelector('.boot-state');
      if (st) st.textContent = stateText;
    }
    inc(weights[id] || 0);
  }
  function setSkip(id, stateText = 'skipped') {
    if (els[id]) {
      els[id].classList.remove('active');
      var st = els[id].querySelector('.boot-state');
      if (st) st.textContent = stateText;
    }
    inc(weights[id] || 0);
  }
  function setError(id, msg = 'Error') {
    if (els[id]) {
      els[id].classList.remove('active');
      els[id].classList.add('error');
      var st = els[id].querySelector('.boot-state');
      if (st) st.textContent = msg;
    }
    inc(weights[id] || 0);
  }
  function inc(val) {
    progress = Math.min(100, progress + (val || 0));
    if (bar) bar.style.width = progress + '%';
    const pr = document.querySelector('.boot-progress');
    if (pr) pr.setAttribute('aria-valuenow', String(progress));
  }
  function setDetail(text) { if (detail) detail.textContent = text || ''; }

  async function waitWindowLoad() {
    if (document.readyState === 'complete') return;
    await new Promise(r => window.addEventListener('load', r, { once: true }));
  }

  async function stepPage() {
    setActive('page', 'loading resources ...');
    setDetail('Waiting for window load ...');
    await waitWindowLoad();
    setDone('page', 'done');
    setDetail('Page loaded.');
  }

  async function checkAuth() {
    setActive('auth');
    setDetail('Checking login status ...');
    const session = localStorage.getItem('session');
    const btn = document.getElementById('showLoginBtn');
    const convertPermanentContainer = document.getElementById('convertPermanentContainer');
    const permanentUploadContainer = document.getElementById('permanentUploadContainer');
    if (!session) {
      setDone('auth', 'not logged in');
      setDetail('No active login detected.');
      window.userLoggedIn = false;
      return { authenticated: false };
    }

    try {
      const res = await fetch('/user/auth', { headers: { 'Authorization': session } });
      if (res.status === 200) {
        window.userLoggedIn = true;
        // Login-Button und UI anpassen
        if (btn) {
          btn.textContent = 'Account';
          btn.onclick = function () { window.location.href = '/user/account'; };
        }
        // Speicherinfo laden und Labels anpassen (wenn Funktion vorhanden)
        if (typeof window.getFreeStorage === 'function') {
          try {
            const free_gb = await window.getFreeStorage();
            const to_add_string = `(${free_gb} GB available)`;
            const convertLabel = convertPermanentContainer ? convertPermanentContainer.querySelector("label[for='convertPermanent']") : null;
            const uploadLabel = permanentUploadContainer ? permanentUploadContainer.querySelector("label[for='permanentUpload']") : null;
            if (convertLabel) convertLabel.textContent = 'Save converted file permanently ' + to_add_string;
            if (uploadLabel) uploadLabel.textContent = 'Save file permanently ' + to_add_string;
          } catch {}
        }
        // Container für permanente Speicherung einblenden
        if (convertPermanentContainer) convertPermanentContainer.classList.remove('hidden');
        // permanentUploadContainer bleibt via Popup-Flow verborgen

        setDone('auth', 'logged in');
        setDetail('Authentication recognized.');
        return { authenticated: true };
      }
      // 401 oder andere Codes
      window.userLoggedIn = false;
      setDone('auth', 'not logged in');
      setDetail('No active login detected.');
      return { authenticated: false };
    } catch (e) {
      window.userLoggedIn = false;
      setSkip('auth', 'not reachable');
      setDetail('Auth endpoint not reachable.');
      return { authenticated: false };
    }
  }

  async function loadMyFiles() {
    setActive('files');
    setDetail('Loading file overview ...');
    const fileList = document.getElementById('fileList');
    if (!fileList) { setSkip('files', 'not available'); return; }

    if (!window.userLoggedIn) {
      setSkip('files', 'Login required');
      setDetail('Please log in to see your files.');
      return;
    }

    try {
      // Nutze die Projektfunktion, die jetzt ein Promise liefert
      const ok = await (typeof window.getUserFiles === 'function' ? window.getUserFiles() : Promise.resolve(false));
      if (ok) {
        setDone('files', 'done');
        setDetail('File overview loaded.');
      } else {
        setSkip('files', 'empty or failed');
        setDetail('No files or error loading.');
      }
    } catch {
      setError('files', 'Error');
      setDetail('Error loading file overview.');
    }
  }

  function formatExpires(ex) {
    try {
      const d = typeof ex === 'number' ? new Date(ex) : new Date(String(ex));
      if (isNaN(d)) return '';
      const diff = d.getTime() - Date.now();
      if (diff <= 0) return 'expired';
      const days = Math.floor(diff / 86400000);
      if (days > 0) return 'in ' + days + ' day(s)';
      const hrs = Math.floor(diff / 3600000);
      if (hrs > 0) return 'in ' + hrs + ' hr(s)';
      const mins = Math.floor(diff / 60000);
      return 'in ' + mins + ' min(s)';
    } catch { return ''; }
  }

  async function finalizeUI() {
    setActive('ui');
    setDetail('Finalizing UI ...');
    await new Promise(r => setTimeout(r, 200));
    setDone('ui', 'ready');
    setDetail('Ready.');
  }

  async function boot() {
    try {
      await stepPage();
      await checkAuth();
      await loadMyFiles();
      await finalizeUI();
    } catch (e) {
      setError('ui', 'Error');
      setDetail('Initialization failed.');
    }
    overlay.classList.add('boot-fade-out');
    setTimeout(() => { overlay.remove(); }, 400);
  }

  window.bootLoader = {
    setActive, setDone, setSkip, setError, setDetail, inc,
    start: boot,
    hide: () => { overlay.classList.add('boot-fade-out'); setTimeout(() => overlay.remove(), 400); }
  };

  Promise.resolve().then(boot);
})();
</script>
</body>
</html>